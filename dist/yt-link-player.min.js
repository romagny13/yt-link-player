function loadYouTubeAPI(){return new Promise(((i,e)=>{if(window.YT&&YT.Player)return void i();const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api",t.onload=()=>waitForYouTubeAPI(i,e),t.onerror=i=>e(i),document.body.appendChild(t)}))}function waitForYouTubeAPI(i,e){const t=setInterval((()=>{window.YT&&YT.Player&&(clearInterval(t),i())}),100)}class YouTubeLinkPlayer{constructor(i={}){this._videoGroups=new Map,this._individualVideos=new Map,this._players=new Map,this._options={linkAttribute:"data-yt-link",targetAttribute:"data-yt-target",videoVisibleClass:"visible",videoWrapperClass:"video-wrapper",videoContainerClass:"video-container",transitionDuration:500,onVideoShow:null,onVideoHide:null,onError:null,autoPlayOnShow:!1,mute:!1,pauseOnHide:!0,autoReset:!1,showOnInit:!1,rootContainer:null,...i},this._rootElement=this._options.rootContainer instanceof HTMLElement?this._options.rootContainer:document.querySelector(this._options.rootContainer)||document,loadYouTubeAPI().then((()=>{this._init(),this._handleInitialDisplay()})).catch((i=>console.error("Erreur lors du chargement de l'API YouTube :",i)))}_init(){try{this._rootElement.querySelectorAll(`a[${this._options.linkAttribute}]`).forEach(this._processLink.bind(this))}catch(i){this._options.onError?.("Initialization failed: "+i.message)}}_processLink(i){if(i.dataset.ytProcessed)return;const e=this._extractVideoId(i.href);e&&(this._setupVideoContainer(i,e),i.dataset.ytProcessed="true")}_extractVideoId(i){try{const e=/(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/user\/\S+|\/ytscreeningroom\?v=|\/sandalsResorts#\w\/\w\/.*\/))([^\/&\?]{10,12})/,t=i.match(e);return t?t[1]:null}catch(i){return this._options.onError?.(`Failed to extract video ID: ${i.message}`),null}}_createPlayer(i,e,t){const o=`youtube-player-${i}-${Date.now()}`,s=document.createElement("div");s.id=o,e.appendChild(s);const n={videoId:i,playerVars:{enablejsapi:1,origin:window.location.origin,mute:this._options.mute?1:0,autoplay:this._shouldAutoPlay(t)?1:0},events:{onReady:()=>{}}},d=new YT.Player(s.id,n);return this._players.set(o,d),o}_shouldAutoPlay(i){return"false"!==i.dataset.autoplay&&("true"===i.dataset.autoplay||this._options.autoPlayOnShow)}_setupVideoContainer(i,e){try{const t=document.createElement("div");t.classList.add(this._options.videoWrapperClass);const o=document.createElement("div");o.className=this._options.videoContainerClass,o.dataset.videoId=e,t.appendChild(o);const s=i.getAttribute(this._options.targetAttribute);s?this._setupGroupVideo(i,t,e,s):this._setupIndividualVideo(i,t,e),i.addEventListener("click",(e=>{e.preventDefault(),this._handleVideoClick(i)}))}catch(e){this._options.onError?.(`Failed to setup video container: ${e.message}`,i)}}_setupGroupVideo(i,e,t,o){const s=document.getElementById(o);s?(this._videoGroups.has(o)||this._videoGroups.set(o,{visibleVideoLink:null,videos:new Set,id:o}),this._videoGroups.get(o).videos.add({link:i,container:e,videoId:t}),s.appendChild(e)):this._options.onError?.(`Target container with id '${o}' not found`,i)}_setupIndividualVideo(i,e,t){this._individualVideos.set(i,{container:e,videoId:t}),i.parentNode.insertBefore(e,i.nextSibling)}_handleVideoClick(i){try{const e=i.getAttribute(this._options.targetAttribute);e?this._handleGroupVideo(i,e):this._handleIndividualVideo(i)}catch(e){this._options.onError?.(`Failed to handle video click: ${e.message}`,i)}}_handleGroupVideo(i,e){const t=this._videoGroups.get(e);t&&t.videos.forEach((({link:e,container:o,videoId:s})=>{e===i?this._toggleVisibility(t,e,o,s):this._hideVideo(o,e,s,t)}))}_handleIndividualVideo(i){const e=this._individualVideos.get(i);e&&this._toggleVideo(e.container,i,e.videoId)}_toggleVisibility(i,e,t,o){if(i.visibleVideoLink===e)this._hideVideo(t,e,o,i),i.visibleVideoLink=null;else{const s=i.visibleVideoLink?this._options.transitionDuration:0;this._showVideoWithDelay(t,e,o,s,i)}}_showVideoWithDelay(i,e,t,o,s){setTimeout((()=>{this._showVideo(i,e,t,s),s&&(s.visibleVideoLink=e)}),o)}_hideVideo(i,e,t,o=null){const s=i.dataset.playerId;if(!s)return;const n=this._players.get(s);if(n&&this._options.pauseOnHide)try{n.pauseVideo()}catch(i){console.warn("Player not ready yet:",i)}i.classList.remove(this._options.videoVisibleClass),this._options.onVideoHide?.(i,e,t,o)}_showVideo(i,e,t,o=null){let s=i.dataset.playerId;if(s){const i=this._players.get(s);if(this._shouldReset(e)&&i)try{i.seekTo(0,!0),this._shouldAutoPlay(e)&&i.playVideo()}catch(i){console.warn("Couldn't reset video:",i)}}else s=this._createPlayer(t,i.querySelector(`.${this._options.videoContainerClass}`),e),i.dataset.playerId=s;i.classList.add(this._options.videoVisibleClass),this._options.onVideoShow?.(i,e,t,o)}_shouldReset(i){if(i.hasAttribute("data-auto-reset")){const e=i.getAttribute("data-auto-reset").toLowerCase();return"true"===e||""===e}return this._options.autoReset}_toggleVideo(i,e,t){i.classList.contains(this._options.videoVisibleClass)?this._hideVideo(i,e,t):this._showVideo(i,e,t)}_handleInitialDisplay(){this._individualVideos.forEach((({container:i,videoId:e},t)=>{this._shouldShowOnInit(t)&&this._showVideo(i,t,e)})),this._videoGroups.forEach((i=>{let e=null;for(const t of i.videos)if(this._shouldShowOnInit(t.link)){e=t;break}!e&&this._options.showOnInit&&(e=Array.from(i.videos)[0]),e&&(this._showVideo(e.container,e.link,e.videoId,i),i.visibleVideoLink=e.link)}))}_shouldShowOnInit(i){if(i.hasAttribute("data-show-on-init")){const e=i.getAttribute("data-show-on-init").toLowerCase();return"true"===e||""===e}return this._options.showOnInit}initializeContainer(i){i.querySelectorAll(`a[${this._options.linkAttribute}]`).forEach(this._processLink.bind(this))}showAllVideos(){this._individualVideos.forEach((({container:i,videoId:e},t)=>{this._showVideo(i,t,e)})),this._videoGroups.forEach((i=>{if(!i.visibleVideoLink){const e=Array.from(i.videos)[0];if(e){const{container:t,link:o,videoId:s}=e;this._showVideo(t,o,s,i),i.visibleVideoLink=o}}}))}hideAllVideos(){this._individualVideos.forEach((({container:i,videoId:e},t)=>{this._hideVideo(i,t,e)})),this._videoGroups.forEach((i=>{i.videos.forEach((({container:e,link:t,videoId:o})=>{this._hideVideo(e,t,o,i)})),i.visibleVideoLink=null}))}destroy(){this._players.forEach(((i,e)=>{i.destroy(),this._players.delete(e)})),this._players.clear(),this._individualVideos.forEach((({container:i},e)=>{i.remove(),e.dataset.ytProcessed=null})),this._videoGroups.forEach((i=>{i.videos.forEach((({container:i,link:e})=>{i.remove(),e.dataset.ytProcessed=null}))})),this._videoGroups.clear(),this._individualVideos.clear()}}